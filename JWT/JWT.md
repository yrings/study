# JWT

> 在当今前后端分离的时代，基于Token的会话保持机制比传统的Session/Cookie机制更加方便，下面是SpringBoot快速集成JWT库java-jwt以完成用户登陆认证。

## 1.1 什么是JWT

**JWT 是 `JSON Web Token`的缩写**。

是为了再网络应用环境间传递声明而执行的一种基于 JSON 的开放标准（RFC 7519）。定义了一种简洁，自包含的方法用户通信双方之间以 JSON 对象的形式安全的传递信息。因为数字签名的存在这些信息是可信的，**JWT 可以使用 HMAC 算法或者是 RSA 的公私密钥进行签名。**



## 1.2 JWT 的请求流程

1. 用户使用账号和密码发起POST请求
2. 服务器使用私钥创建一个JWT
3. 服务器返回这个 JWT 给浏览器
4. 浏览器将该 JWT 串在请求头中向服务器发送请求
5. 服务器验证该 JWT
6. 返回响应的资源给浏览器



## 1.3 JWT 数据结构

> JWT 是由三段信息构成的，将这三段信息文本用 `.` 连接一起就构成了 JWT 字符串。

三段信息分别是：

* 头部`Header`：

  是一个 JSON 对象，描述 JWT 的元数据

  ```json
  {
      "alg": "HS256",
      "typ": "JWT"
  }
  ```

  `alg`表示签名的算法（algorithm）,默认是 `HMAC SHA256`，写成HS256；

  `typ` 属性表示这个令牌的类型。

  最后，将上面的 JSON 对象使用 **Base64URL 算法**转成字符串

* 负载`Payload`：

  也是 JSON 对象，用来存放实际需要传递的有效信息。包含三个部分

  1. **标准中注册的声明**

     （建议但不强制使用）

     * `iss（issuer）`：签发人
     * `exp（expiration time）`：过期时间，必须大于签发时间
     * `sub（subject）`：主题
     * `aud（audience）`：受众
     * `nbf（not Before）`：生效时间
     * `iat（Issued At）`：签发时间
     * `jti（JWT ID）`：编号，JWT的唯一身份标识，主要用来作为一次性 token，从而回避重放攻击

  2. **公共的声明**

     可以添加任何信息，一般添加用户和相关信息或者其它业务需要的必要信息。但不建议添加敏感信息，因为该部分字啊客户端可解密

  3. **私有的声明**

     私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为 base64 是对称解码的，意味着该部分信息可以归类为明文信息。

  这个 JSON 对象也要使用 **Base64URL 算法**转成字符串。

* 签名`Signature`：

  这个部分是对前面两部分的签名，防止数据篡改。

  ①首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户。然后，使用 `Header`里面指定的签名算法，按照下面的公式产生签名

  ```java
  HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secrect);
  ```

  ②算出签名之后，把三部分拼成一个字符串，每个部分之间用`.`分隔，返回给用户。

  > 有关于Base64URL 算法







